# UniVH

## Overview
RNA viruses, characterized by their exceptionally high mutation rates and rapid adaptability, pose significant challenges to public health. Despite the vast amounts of viral sequence data revealed through metagenomic sequencing, identifying viruses with high zoonotic potential remains a critical issue in pandemic preparedness. Existing host prediction models often suffer from limitations in accuracy and coverage, particularly when applied to emerging viruses and rare host species.

To overcome the scalability and precision limitations of current methods, we developed the UniVH framework. This unified framework simultaneously models associations between different viral families and host taxa, filling the gaps in both accuracy and coverage. By leveraging advanced genomic language models, UniVH embeds the complete gene repertoires of viruses and hosts into a unified representation space, efficiently compressing viral and host features based on protein functional classification to improve prediction accuracy.

UniVH was trained on a large-scale dataset, encompassing 90 viral families and 240 host families, enabling species-level host predictions for emerging and under-researched viruses.

---

## Requirements
- Python packages:
  - `torch==1.12.1.post201`
  - `pandas==2.2.3`
  - `numpy==2.2.4`
  - `matplotlib==3.10.1`
  - `sklearn==1.6.1`

---

## Data Preparation
1. **Dataset Access**  
   - The required data and pre-trained model files are available on **[Zenodo](https://doi.org/10.5281/zenodo.17505409)**.
   - After downloading from Zenodo, **extract (unzip) all files and place the extracted contents directly into the `UniVH-model-main/` project folder** (i.e., the repository root directory).
   - `LucaOneApp/` is downloaded from **[LucaOne](https://github.com/LucaOne/LucaOne)**.

   **Example directory layout (after extraction):**
   ```text
   UniVH-model-main/
     README.md
     01_hmmscan.py
     01_lucaone.sh
     02_predict_geoNA.py
     protein_embed_dict_20250912_010034.pkl
     protein_func_map_20250912_010034.pkl
     combined.hmm
     host_info_geo_env_0.9.csv
     kegg_host_final.csv
     vfam.annotations.tsv
     model_train/
     test/
     LucaOneApp/
   ```

2. **Protein Functional Annotation (HMM) & Virus–Host Combination Generation**  
   - This step runs **HMM-based functional annotation** for the input viral proteins, summarizes the annotation results, and merges them with VFAM functional descriptions to produce a final annotated feature table.  
   - At the same time, it generates a CSV file containing **all candidate virus–host combinations** (virus × host) for downstream prediction.  

   **Example**
   ```bash
   python 01_hmmscan.py \
     --source_dir ../UniVH-model-main/test/aa.data \
     --virus_host_output ../UniVH-model-main/test/virus_host.csv \
     --max_workers 16
   ```

   **Input**
   - `aa.data/`: a folder containing viral protein FASTA files (`.fasta`, `.fa`, or `.faa`). **Each virus corresponds to one file (named by the virus ID/name), and each file contains all protein sequences of that virus.** 

   **Outputs**
   - `test/HMM/combined_hmmscan_results_with_func.csv`: final annotated feature table (hmmscan hits merged with VFAM functional descriptions).  
   - `test/virus_host.csv`: all candidate virus–host combinations (`SeqName.virus` × `SeqName.host`) for downstream prediction.

3. **Protein Embedding**  
   - Use the protein language model **[LucaOne](https://github.com/LucaOne/LucaOne)** to calculate embeddings for the viruses to be predicted (from nucleotide sequences).

   **Example**
   ```bash
   bash 01_lucaone.sh \
     --input_file ./UniVH-model-main/test/PV241319.1_nt.fasta \
     --save_path ./UniVH-model-main/test/embedding \
     --gpu_id 0
   ```

   **Input**
   - `--input_file`: a FASTA file containing **nucleotide sequences** of the viruses to be embedded.

   **Output**
   - `--save_path`: an output directory where LucaOne saves the generated embedding files.


---

## Usage
- During prediction, provide the nucleotide and amino acid sequences of the virus CDS (coding sequence).  
  - **Nucleotide sequences** are represented using embeddings generated by **LucaOne**.  
  - **Amino acid sequences** are functionally annotated via **HMM**.
  - An example virus (*Acute bee paralysis virus*) is provided under `test/`.

**Example**
```bash
python 02_predict_geoNA.py --pred_dir ../UniVH-model-main/test
```

- `--pred_dir` stores all prepared inputs and intermediate results (e.g., `virus_host.csv`, `HMM/combined_hmmscan_results_with_func.csv`, `embedding/`).
- Output: `--pred_dir/virus_host_pred_result_with_taxonomy.csv`  
  Each row is a virus–host pair; `pred_prob` is the predicted interaction probability (0–1).

---

## Reference
If you use this dataset or framework, please cite the corresponding publication.












